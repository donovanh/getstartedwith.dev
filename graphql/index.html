<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Learn how to build a simple GraphQL API.">
<meta name="author" content="Donovan Hutchinson"/>
<title>GraphQL - GetStartedWith.dev</title>

<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/logos/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/logos/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/logos/favicon-16x16.png">

<link rel="stylesheet" type="text/css" href="/assets/css/code-highlight.css">
<link rel="stylesheet" type="text/css" href="/assets/css/styles.css">

<!-- Social meta tags -->
<meta property="og:title" content="GraphQL - GetStartedWith.dev">
<meta property="og:description" content="Learn how to build a simple GraphQL API.">
<meta property="og:image" content="https://getstartedwith.dev/assets/img/social/graphql.png">
<meta property="og:url" content="https://getstartedwith.dev/graphql/">
<meta name="twitter:card" content="summary_large_image">


</head>
<body>
    <a id="top"></a>
    <header class="page-header">
    <h3><a href="/">Get Started With...</a></h3>
</header>


    <main>
        

<article class="post">
    <header class="post-header">
        <h1>GraphQL</h1>
        <p class="lead">Let&#39;s learn how to use GraphQL with JavaScript, using Node.js and Apollo to build and explore a simple API.</p>
        <details>
            <summary>Table of contents</summary>
            <div class="toc">
        <ol><li><a href="#what-is-graphql">What is GraphQL</a><ol><li><a href="#graphql-vs-rest">GraphQL vs REST</a></li><li><a href="#when-to-use-graphql">When to use GraphQL</a></li></ol></li><li><a href="#build-a-graphql-server">Build a GraphQL server</a><ol><li><a href="#schema">Schema</a></li><li><a href="#resolvers">Resolvers</a></li><li><a href="#set-up-node.js%2C-graphql-and-apollo">Set up Node.js, GraphQL and Apollo</a></li><li><a href="#create-our-node.js-server">Create our Node.js server</a></li><li><a href="#schema-and-resolvers">Schema and resolvers</a></li><li><a href="#running-our-graphql-server">Running our GraphQL server</a></li><li><a href="#hello-graphql-world">Hello GraphQL world</a></li></ol></li><li><a href="#graphql-queries">GraphQL queries</a><ol><li><a href="#at-the-movies">At the movies</a></li><li><a href="#adding-data-and-resolvers">Adding data and resolvers</a></li><li><a href="#simple-query">Simple query</a></li><li><a href="#complex-queries">Complex queries</a></li><li><a href="#arguments">Arguments</a></li><li><a href="#aliases">Aliases</a></li><li><a href="#fragments">Fragments</a></li><li><a href="#operation-name">Operation name</a></li><li><a href="#variables">Variables</a></li><li><a href="#directives">Directives</a></li><li><a href="#mutations">Mutations</a></li><li><a href="#inline-fragments">Inline Fragments</a></li><li><a href="#meta-fields">Meta fields</a></li><li><a href="#adding-new-queries">Adding new queries</a></li></ol></li><li><a href="#graphql-from-the-browser">GraphQL from the browser</a><ol><li><a href="#remote-apollo-server">Remote Apollo server</a></li><li><a href="#website%3A-html-%26-css">Website: HTML &amp; CSS</a></li><li><a href="#making-a-get-request">Making a GET request</a></li><li><a href="#requesting-actors-and-movies">Requesting actors and movies</a></li><li><a href="#adding-mutations">Adding mutations</a></li></ol></li><li><a href="#wrapping-up">Wrapping up</a></li><li><a href="#next-steps">Next steps</a><ol><li><a href="#graphql-implementations">GraphQL implementations</a></li><li><a href="#best-practices-and-testing">Best practices and testing</a></li><li><a href="#third-party-services">Third party services</a></li><li><a href="#further-learning">Further learning</a></li></ol></li></ol></div>
        </details>
    </header>
    
    <div class="post-content">
        <h2 id="what-is-graphql" tabindex="-1">What is GraphQL</h2>
<p>GraphQL is a query language that is designed to be a better way of requesting data from APIs.</p>
<p>In recent years, most web-based APIs worked in a style called <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>. With this approach we would interact with servers to request and send data using different URLs that defined the kind of response we wanted.</p>
<p>With REST we would make GET requests for data, PUT or POST requests to send data to the server to make changes. We'd use different URLs for different sets of data.</p>
<p>GraphQL is different. It still allows us to make requests to our API server, but it allows us to more carefully describe the shape of the data we want back. In doing so, we can ask for just the data we need, and reduce the number of requests needed to request complex data sets.</p>
<h3 id="graphql-vs-rest" tabindex="-1">GraphQL vs REST</h3>
<p>For example, with REST we could send a GET request to a <code>movies</code> API to obtain a list of newly released movies. We would send a <code>GET</code> request to something like <code>oursite.com/api/movies/new</code> and it would give us a list of movie IDs.</p>
<p>If we wanted specific movie details on each of those IDs, we would need to then assemble at least one more query to ask for each of the movies by ID.</p>
<p>This would often mean our front-end spends a lot of time sending out multiple requests, and then the data we get back might be larger than we need, wasting bandwidth.</p>
<p>With GraphQL we could cut back on the number of requests.</p>
<p>If our API had a list of movies, and a list of actors that cross-referenced the movies list, we can request only the data we need by sending a request like this:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span><br>  <span class="token object">movies</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>    <span class="token object">starring</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This request returns the data we are looking for in the form of an array of movie objects containing <code>title</code>, and a list of names of the actors starring in the movies.</p>
<p>With REST we would have had to make several requests, one to the <code>movies</code> database, and perhaps several to the <code>actors</code> database.</p>
<p>By writing relational queries like this, we can achieve more in a single request, save on bandwidth and write less code.</p>
<p>In this guide I'll mostly be focusing on how we can make use of GraphQL with JavaScript and web apps, but GraphQL is not limited to any one technology. GraphQL is a specification, created by Facebook, that defines ways to access data. This means how we use it depends on what we want to build.</p>
<p>Implementations of the GraphQL API are available from many sources and we have many tools to choose from including server-side and client-side implementations built with most languages, not just JavaScript.</p>
<p>You can explore some of these options on the <a href="https://graphql.org/code/">GraphQL code section</a>.</p>
<h3 id="when-to-use-graphql" tabindex="-1">When to use GraphQL</h3>
<p>GraphQL is useful when you are building web apps that load data from a back-end API. If you have control of the back-end, you can make use of GraphQL to define ways your front-end can request data.</p>
<p>This can make building your web applications faster to develop and result in lighter, faster queries.</p>
<p>Sometimes we may have to use an external REST-based API. In these situations it might be worthwhile building an in-between GraphQL layer to allow our front-end code to make use of GraphQL queries, which are then handled with the necessary REST requests by the back-end.</p>
<p>Let's see how we can build our own GraphQL server, explore some ways of querying a database, and then see how this can translate into a simple web application.</p>
<h2 id="build-a-graphql-server" tabindex="-1">Build a GraphQL server</h2>
<p>Let's make a simple server that we can then make queries on and explore the different approaches GraphQL gives us.</p>
<p>A GraphQL server is made up of two main parts.</p>
<h3 id="schema" tabindex="-1">Schema</h3>
<p>A GraphQL schema is how we describe the shape of our API. It is made up of a list of type definitions that describe what queries we allow, and the types of objects we are working with.</p>
<p>A schema can look like a list of definitions like this:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">SomeObject</span> <span class="token punctuation">{</span><br>  id<span class="token operator">:</span> String<span class="token operator">!</span><br>  name<span class="token operator">:</span> String<span class="token operator">!</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span><br>  <span class="token function">getObject</span><span class="token punctuation">(</span>id<span class="token operator">:</span> String<span class="token operator">!</span><span class="token punctuation">)</span><span class="token operator">:</span> SomeObject<br><span class="token punctuation">}</span></code></pre>
<h3 id="resolvers" tabindex="-1">Resolvers</h3>
<p>With a schema in place, we need to build the actual response. To do this we use <code>resolvers</code>. These take the form of functions that return the necessary data for our queries. In the above schema, we might have a resolver like this:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token function-variable function">getObject</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getObjectFromDatabase</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>This describes the function that will be called when the <code>getObject</code> query is received.</p>
<p>We will explore how to build a schema and the asociated resolvers more when we set up our API.</p>
<p>That's enough of the theory for now. Let's learn how to set up a real schema with resolvers and explore our own GraphQL API.</p>
<h3 id="set-up-node.js%2C-graphql-and-apollo" tabindex="-1">Set up Node.js, GraphQL and Apollo</h3>
<p>If we haven't already done so, you should <a href="https://nodejs.org/en/download/">install Node.js</a>. This will give us <code>npm</code> commands as well as letting us run our JavaScript code locally.</p>
<p>With that done, make a new directory for our project, navigate to that directory in your command line, and then run:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> init --yes</code></pre>
<p>This will initialise our project and create a <code>package.json</code> file that helps define the project and any dependencies. Hit return a few times for the default values.</p>
<p>Then install our dependencies:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> apollo-server graphql -S</code></pre>
<p>This installs a few things we need.</p>
<p>This will install <a href="https://www.npmjs.com/package/apollo-server">apollo-server</a>, which will handle serving our GraphQL API, along with <a href="https://www.npmjs.com/package/graphql">GraphQL</a>, a JavaScript-based implementation of the GraphQL query language.</p>
<h3 id="create-our-node.js-server" tabindex="-1">Create our Node.js server</h3>
<p>Creating our own Node.js server is as simple as creating a JavaScript file, <code>index.js</code> and adding the following code:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> ApolloServer<span class="token punctuation">,</span> gql <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apollo-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./database.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <br><span class="token comment">// Construct our request types, using GraphQL schema language</span><br><span class="token keyword">const</span> typeDefs <span class="token operator">=</span> <span class="token function">gql</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  type Query {<br>    hello: String<br>  }<br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br> <br><span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span><br>  Query<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">hello</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// The ApolloServer constructor requires two parameters: your schema</span><br><span class="token comment">// definition and your set of resolvers.</span><br><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// The `listen` method launches a web server.</span><br>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ðŸš€  Server ready at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Let's walk through this code and explore what it does, before we see it in action.</p>
<p>First we use <code>require</code> to call in the modules we need for this server to work. These are the same modules we installed earlier.</p>
<p>Then we define two important GraphQL components, the <code>typeDefs</code> and <code>resolvers</code>.</p>
<h3 id="schema-and-resolvers" tabindex="-1">Schema and resolvers</h3>
<p>In our <code>typeDefs</code> variable we set up a string that describes the schema for our GraphQL API.</p>
<p>A schema is like a description of the &quot;shape&quot; of the API. It defines what requests we can make and what type of response to expect.</p>
<p>To begin with we have a definition for <code>Query</code>. This is a container into which we put the type definition of any queries we want to make.</p>
<p>The first query we've designer is called <code>hello</code>, and it should give us a response of type <code>string</code>.</p>
<p>We'll adjust this schema later to give allow us to test more of the GraphQL functions.</p>
<p>Next we set up a resolver function. This is an object containing functions that map to the queries defined earlier. In this case, we set up a similar <code>Query</code> container and in it, a method called <code>hello</code>.</p>
<p>This <code>hello</code> function is a simple one that returns a string (<code>Hello world!</code>). In a real implementation this could call out to our API and query a database, before returning the expected data.</p>
<p>Lastly we define our <code>ApolloServer</code> app. By default this will run at the root of <code>localhost</code>, on the default port, <code>4000</code>.</p>
<h3 id="running-our-graphql-server" tabindex="-1">Running our GraphQL server</h3>
<p>Now that we've set up a simple server, let's run it.</p>
<pre class="language-bash"><code class="language-bash">node index.js</code></pre>
<p>You should see some output in the command line like:</p>
<pre class="language-bash"><code class="language-bash">ðŸš€  Server ready at http://localhost:4000/</code></pre>
<p>If you open your web browser and go to the address <code>http://localhost:4000/</code> you should see the Apollo web interface.</p>
<p><img src="/assets/img/posts/graphql/apollo-server.png" alt="A default Apollo server web view"></p>
<h3 id="hello-graphql-world" tabindex="-1">Hello GraphQL world</h3>
<p>Let's try out our new GraphQL server by sending it a query.</p>
<p>On the left panel we find some comments (starting with <code>#</code>). Replace the comments with the following query:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span><br>  <span class="token property">hello</span><br><span class="token punctuation">}</span></code></pre>
<p>Then press the Play (<code>â–¶</code>) button (or use <code>Ctrl + Enter</code>) to run our query. This should activate our <code>hello</code> resolver function, which generates the following response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"hello"</span><span class="token operator">:</span> <span class="token string">"Hello world!"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Here we can see that when we sent the query containing the object with <code>hello</code>, we received back a JSON object that has a similar shape but with the result of our query added.</p>
<h2 id="graphql-queries" tabindex="-1">GraphQL queries</h2>
<p>Now that we have a server running, we can explore some more GraphQL queries. Make sure to bookmark the <a href="https://graphql.org/learn/queries/">official GraphQL docs</a> so that you can check how things work as well as find out about new features.</p>
<h3 id="at-the-movies" tabindex="-1">At the movies</h3>
<p>To better explore how GraphQL queries work, we're going to set up a schema along with some new resolvers and give them some data to work with.</p>
<p>Note: If you prefer the finished code, you can <a href="https://github.com/donovanh/graphql-apollo-example">find this finished example on GitHub</a>.</p>
<p>In our index.js file begin by replacing the <code>const typeDefs...</code> section with the following:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token property">const</span> <span class="token property">typeDefs</span> <span class="token operator">=</span> <span class="token property-query">gql</span><span class="token punctuation">(</span>`<br>  <span class="token keyword">type</span> <span class="token class-name">Actor</span> <span class="token punctuation">{</span><br>    <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>    <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>    <span class="token attr-name">appearsIn</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Movie</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">type</span> <span class="token class-name">Movie</span> <span class="token punctuation">{</span><br>    <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>    <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>    <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Actor</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span><br>    <span class="token attr-name">actors</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Actor</span><span class="token punctuation">]</span><br>    <span class="token attr-name">movies</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Movie</span><span class="token punctuation">]</span><br>    <span class="token attr-name">actor</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Actor</span><br>    <span class="token attr-name">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Movie</span><br>  <span class="token punctuation">}</span><br>`<span class="token punctuation">)</span>;</code></pre>
<p>We have introduced two new <code>type</code> definitions here, <code>Actor</code> and <code>Movie</code>. By convention we start these with capital letters so that it's easier to tell that we're working with custom object types.</p>
<p>The <code>Actor</code> definition states that each Actor object should have an <code>id</code> along with a <code>name</code>, which are strings, along with an array of <code>Movie</code> objects which we call <code>appearsIn</code>.</p>
<p>The exclamation points you see in the definition are a way of saying these are required. Each <code>Actor</code> object requires a string for <code>id</code> and <code>name</code>, and should appear in at least one <code>Movie</code>.</p>
<p>Similarly, we give the <code>Movie</code> object it's own definition.</p>
<p>Then we expand our list of <code>Query</code> definitions. In GraphQL, we can have two main types of queries, referred to as <code>query</code>, <code>mutation</code> or <code>subscription</code>. We're starting with the first type but will explore the others later.</p>
<p>To give us the ability to query our new data, we've added <code>actors</code>, <code>movies</code>, <code>actor</code> and <code>movie</code> queries, replacing the <code>hello</code> query we had before.</p>
<p>These new queries will allow us to retrieve an array of actors, movies, or a single one of each.</p>
<h3 id="adding-data-and-resolvers" tabindex="-1">Adding data and resolvers</h3>
<p>With these new queries added, we need to build <code>resolvers</code> to connect our data to the queries.</p>
<p>But wait, we need data! If you like you could hook up a database here and use your resolvers to access the database as needed. However for simplicity I'm going to set up a fake database as a static file.</p>
<p>To set it up <a href="https://gist.github.com/donovanh/ce90a2d98b148f642b0a4ac42ce2a86b">download the content of this gist</a> and save it as <code>database.js</code>.</p>
<p>The <code>database.js</code> file exports an object that looks a bit like this:</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  actors<span class="token operator">:</span> <span class="token punctuation">{</span><br>    a01<span class="token operator">:</span> <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> <span class="token string">'a01'</span><span class="token punctuation">,</span><br>      name<span class="token operator">:</span> <span class="token string">'Harvey Keitel'</span><span class="token punctuation">,</span><br>      appearsIn<span class="token operator">:</span> <span class="token punctuation">[</span><br>        movies<span class="token punctuation">.</span>m01<br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  movies<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> <span class="token string">'m01'</span><span class="token punctuation">,</span><br>      title<span class="token operator">:</span> <span class="token string">'Reservoir Dogs'</span><span class="token punctuation">,</span><br>      starring<span class="token operator">:</span> <span class="token punctuation">[</span><br>        actors<span class="token punctuation">.</span>a01<br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>We have two sets of data, containing <code>actors</code> and <code>movies</code>. Each references the other, which we will use to our advantage when creating queries.</p>
<p>Back in your <code>index.js</code> file, we need to bring in our database. Add this line near the top of the file:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./database.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>We can now update our resolvers, replacing them as follows:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span><br>  Query<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">actors</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>actors<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">movies</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>movies<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">actor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>actors<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">movie</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>movies<span class="token punctuation">[</span>id<span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>These new resolvers follow the same pattern as the <code>Query</code> type we defined earlier. With these in place we should be able to try some GraphQL queries.</p>
<h3 id="simple-query" tabindex="-1">Simple query</h3>
<p>In our browser, running at <code>http://localhost:4000/</code>, we should see our Apollo Playground.</p>
<p>On the left side, replace the content with this query:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token object">movies</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This is a simple GraphQL query. It tells our API that it would like to call the query <code>movies</code>, and the shape of the data we expect back is <code>{ title }</code>.</p>
<p>Pressing Play (<code>â–¶</code>) button and we should see the following JSON result on the right side:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"movies"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"True Romance"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Pulp Fiction"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In the result we receive a <code>data</code> object that lists out our query and the data returned by our query.</p>
<p>What if we wanted more than just titles? We can adjust our query:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token object">movies</span> <span class="token punctuation">{</span><br>    <span class="token property">id</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This should give us a list that also includes the <code>id</code> field from each of our movies. GraphQL can automatically return any data if the fields match the properties.</p>
<p>In this case, our <code>movies</code> objects contain <code>id</code> and <code>title</code>, so GraphQL is smart enough to know that we want that data from each object.</p>
<h3 id="complex-queries" tabindex="-1">Complex queries</h3>
<p>As we shape our queries we can create more complex shapes. Let's add the <code>starring</code> field.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token object">movies</span> <span class="token punctuation">{</span><br>    <span class="token property">id</span><span class="token punctuation">,</span><br>    <span class="token property">title</span><span class="token punctuation">,</span><br>    <span class="token object">starring</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Since <code>starring</code> is an array of <code>Actor</code> objects, GraphQL will automatically return each of these objects to us. We can then specify what we want from each of these objects. We know from our definition that each <code>Actor</code> has a <code>name</code> and we can request it.</p>
<p>The result should now include a list of actors!</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"movies"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"m01"</span><span class="token punctuation">,</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><span class="token punctuation">,</span><br>        <span class="token property">"starring"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>          <span class="token punctuation">{</span><br>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Harvey Keitel"</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          <span class="token punctuation">{</span><br>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Tim Roth"</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          <span class="token punctuation">{</span><br>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Steve Buscemi"</span><br>          <span class="token punctuation">}</span><span class="token punctuation">,</span><br>          <span class="token punctuation">{</span><br>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Quentin Tarantino"</span><br>          <span class="token punctuation">}</span><br>        <span class="token punctuation">]</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      ...</code></pre>
<p>Try playing around with the queries. You can change <code>movies</code> to <code>actors</code> and explore the data from that angle too.</p>
<h3 id="arguments" tabindex="-1">Arguments</h3>
<p>So far we have created wide queries that return all our movies and actors. What if we only wanted one specific movie? Let's use our <code>movie</code> query along with an <code>argument</code> to specify just one result.</p>
<p>We can pass an argument by adding <code>(id: &quot;value&quot;)</code> to our query like so:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In the above we specify the movie with <code>id</code> of <code>m01</code>. It should give us this result:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"movie"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>But what if we wanted more than one movie? We might try something like this:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span><span class="token string">"m02"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment"># ERROR</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre>
<p>However this won't work. The two identical <code>movie</code> fields are in conflict. To fix this we can use <code>aliases</code>.</p>
<h3 id="aliases" tabindex="-1">Aliases</h3>
<p>To query more than one movie at a time we need to give each query a unique name, or <code>alias</code>. Let's adjust the above query to call the first movie <code>movie1</code> and the second, <code>movie2</code>:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token attr-name">movie1</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br>  <span class="token attr-name">movie2</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span><span class="token string">"m02"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This should give us a result:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"movie1"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token property">"movie2"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"True Romance"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This works nicely and might be fine for simple queries, but if we were to request more than just <code>title</code> from each movie, we'd end up with a lot of repetition. For example:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token attr-name">movie1</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>    <span class="token object">starring</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token attr-name">movie2</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span><span class="token string">"m02"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>    <span class="token object">starring</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>The above works but can quickly become difficult to manage. We can simplify this query using <code>fragments</code>.</p>
<h3 id="fragments" tabindex="-1">Fragments</h3>
<p>A fragment is a reusable set of fields that we can apply to our queries. It takes the form of <code>fragment foo on Object</code>, where <code>foo</code> is whatever name we want to give it and <code>Object</code> is one of the types of objects we have defined such as <code>Movie</code> or <code>Actor</code>.</p>
<p>We can improve our alias example above by using fragments:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span> <br>  <span class="token attr-name">movie1</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><span class="token fragment function">movieFields</span><br>  <span class="token punctuation">}</span><br>  <span class="token attr-name">movie2</span><span class="token punctuation">:</span> <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span><span class="token string">"m02"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><span class="token fragment function">movieFields</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">fragment</span> <span class="token fragment function">movieFields</span> <span class="token keyword">on</span> <span class="token class-name">Movie</span> <span class="token punctuation">{</span><br>  <span class="token property">title</span><br>  <span class="token object">starring</span> <span class="token punctuation">{</span><br>    <span class="token property">name</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In this query we are using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread syntax</a> (<code>...</code>) to expand the fields from the <code>movieFields</code> fragment.</p>
<p>Since we only define the <code>movieFields</code> fields once, it removes some of the repetition in our query.</p>
<h3 id="operation-name" tabindex="-1">Operation name</h3>
<p>Each of our queries so far have been using a shorthand. When we are working with more queries, we can be more specific and use the full <code>operation type</code> as well as giving each query an <code>operation name</code>.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">AllMovies</span> <span class="token punctuation">{</span> <br>  <span class="token object">movies</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">query</span> <span class="token definition-query function">AllActors</span> <span class="token punctuation">{</span> <br>  <span class="token object">actors</span> <span class="token punctuation">{</span><br>    <span class="token property">name</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Using names operations is recommended in production code as it can help when debugging as error messages can point to specific named queries.</p>
<p>If we supply our browser with the above queries, we can run them one at a time as the &quot;Execute Query&quot; button will give a dropdown of each query.</p>
<h3 id="variables" tabindex="-1">Variables</h3>
<p>When we use GraphQL in production we won't want every query to perform one specific task. We might want our <code>movie</code> query to be able to query any of our movies, rather than just one specific one.</p>
<p>This means avoiding hard-coding the movie ID. Let's make a dynammic, reusable query using <code>variables</code>.</p>
<p>First we set up our query:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">MovieQuery</span><span class="token punctuation">(</span><span class="token variable">$movieId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$movieId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This query now has a new addition, the <code>($movieId: String!)</code> portion added to the operation name. This tells the query to expect a <code>movieId</code>, and that it should be a required string.</p>
<p>Next, our query makes use of this <code>$movieId</code> variable, replacing the hard-coded <code>m01</code> value from earlier.</p>
<p>To use this query we need to pass our variables along with this dynamic query. In the web browser window, look for the <code>Query Variables</code> panel (at the bottom of the left side).</p>
<p>Open this and add our variable as JSON:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"movieId"</span><span class="token operator">:</span> <span class="token string">"m01"</span><br><span class="token punctuation">}</span></code></pre>
<p>We should now be able to execute our query and see the movie.</p>
<h4 id="default-values" tabindex="-1">Default values</h4>
<p>Variables can be given a default value, which can be useful when we want to fall back on one specific result.</p>
<p>Add a default value to our <code>$movieId</code> variable by adding <code>= &quot;m01&quot;</code> to the definition:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">MovieQuery</span><span class="token punctuation">(</span><span class="token variable">$movieId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token string">"m02"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$movieId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Now if we delete the query variable from the panel, and run this query, it will display our default movie (movie <code>m02</code> in this example).</p>
<p>Adding variables to our queries makes them more flexible and saves us having to mess around with strings when generating the queries. However we can add more logic to our queries. One way to do this is to use <code>directives</code>.</p>
<h3 id="directives" tabindex="-1">Directives</h3>
<p>In GraphQL, a directive is a way to add conditional logic to our queries. We can have the query make adjustments on the fly based on conditions (<code>if something is true, then...</code>).</p>
<p>We can do this using two directives, <code>@include</code> and <code>@skip</code>.</p>
<h4 id="directive%3A-%40include" tabindex="-1">Directive: @include</h4>
<p>Let's create a query that gives us a list of who stars in a movie only when we want the extra information.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">MovieInfo</span><span class="token punctuation">(</span><br>  <span class="token variable">$movieId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token string">"m02"</span><span class="token punctuation">,</span><br>  <span class="token variable">$withStars</span><span class="token punctuation">:</span> <span class="token scalar">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$movieId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>    <span class="token property">starring</span> <span class="token directive function">@include</span><span class="token punctuation">(</span><span class="token attr-name">if</span><span class="token punctuation">:</span> <span class="token variable">$withStars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This brings two changes to the query. First we add another variable, <code>$withStars</code> to our named operation. This is an optional boolean with a default value of <code>false</code>.</p>
<p>We then use this variable in the directive on the <code>starring</code> field. By adding <code>@include(if: $withStars)</code> this tells the query to only include this field if <code>$withStars</code> is <code>true</code>.</p>
<p>Try adding the above query and pass in the variables JSON:</p>
<pre><code>{
  &quot;movieId&quot;: &quot;m01&quot;,
  &quot;withStars&quot;: true
}
</code></pre>
<p>Pressing Play should return a movie with the list of starring actors.</p>
<h4 id="directive%3A-%40skip" tabindex="-1">Directive: @skip</h4>
<p>It might make more sense to ask our API for a summary of a movie, and expect the full version to contain extra information. This would allow us to expand the definition later without being locked into including specific parts.</p>
<p>Let's use the <code>@skip</code> directive and adjust our query to present a summary version.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">MovieInfo</span><span class="token punctuation">(</span><br>  <span class="token variable">$movieId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token string">"m02"</span><span class="token punctuation">,</span><br>  <span class="token variable">$summary</span><span class="token punctuation">:</span> <span class="token scalar">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$movieId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><br>    <span class="token property">starring</span> <span class="token directive function">@skip</span><span class="token punctuation">(</span><span class="token attr-name">if</span><span class="token punctuation">:</span> <span class="token variable">$summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This example replaces the <code>@include</code> with <code>@skip</code> and makes use of a variable <code>$summary</code>. This will give us the option of being able to request a summary of the movie as needed, but by default will return the extended data.</p>
<p>We can test this by passing in the variables JSON:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"movieId"</span><span class="token operator">:</span> <span class="token string">"m01"</span><span class="token punctuation">,</span><br>  <span class="token property">"summary"</span><span class="token operator">:</span> <span class="token boolean">true</span><br><span class="token punctuation">}</span></code></pre>
<p>Try changing these variables and find more ways to adjust the returned data.</p>
<h3 id="mutations" tabindex="-1">Mutations</h3>
<p>So far we've only been using the default <code>query</code> to fetch data from our API. In REST terms, this is similar to sending a <code>GET</code> request, in that it requests data but should not send changes to our server.</p>
<p>A convention in GraphQL is to use <code>mutation</code> when we send a query that will make changes to our data. This is more like how we might use a <code>POST</code> or <code>PUT</code> in REST.</p>
<p>We can use a <code>mutation</code> to create a new movie on the server. Before we send a query, we need to set up the server to receive it.</p>
<p>In our <code>index.js</code> file we begin by adding two new <code>type</code> entries to our <code>schema</code> section:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">NewMovie</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>  <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>  <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Mutation</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">createMovie</span><span class="token punctuation">(</span><br>    <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span><br>    <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br>  <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">NewMovie</span><br><span class="token punctuation">}</span></code></pre>
<p>The first part, <code>NewMovie</code> is similar to the original <code>Movie</code> definition but we've simplified the <code>starring</code> field. This will make our server response a little simpler.</p>
<p>We then create a new <code>Mutation</code> type. This is where we define our mutation queries. In this case we're defining a <code>createMovie</code> query, which returns an object of type <code>NewMovie</code>.</p>
<p>Next we update our <code>resolvers</code>:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span><br>  Query<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">actors</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>actors<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">movies</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>movies<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">actor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>actors<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">movie</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> db<span class="token punctuation">.</span>movies<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token function-variable function">moviesStarring</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> actor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>actors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">actor</span><span class="token punctuation">)</span> <span class="token operator">=></span> actor<span class="token punctuation">.</span>name <span class="token operator">===</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">return</span> actor<span class="token punctuation">.</span>appearsIn<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  Mutation<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function-variable function">createMovie</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> starring <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// We could validate and update a database here</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        id<span class="token operator">:</span> <span class="token string">'new-id'</span><span class="token punctuation">,</span><br>        title<span class="token punctuation">,</span><br>        starring<br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>We now have a <code>createMovie</code> resolver. Since we're not working with a real database, we don't have that logic in place but for now we can return a &quot;new&quot; movie to show how the mutation works.</p>
<p>Let's test our mutation:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">mutation</span> <span class="token definition-mutation function">NewMovie</span><span class="token punctuation">(</span><br>  <span class="token variable variable-input">$title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span><br>  <span class="token variable variable-input">$starring</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query property-mutation">createMovie</span><span class="token punctuation">(</span><br>    <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token variable variable-input">$title</span><span class="token punctuation">,</span><br>    <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token variable variable-input">$starring</span><br>  <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">id</span><br>    <span class="token property">title</span><br>    <span class="token property">starring</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>We have changed the <code>query</code> to a <code>mutation</code>, and adjusted the variables so that this mutation will expect a <code>title</code> and an array of <code>starring</code> strings.</p>
<p>When it creates the movie, it will expect an object in response that will include a new <code>id</code>, the <code>title</code> we gave and the <code>starring</code> array.</p>
<p>We can test this using some variables:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"A New Movie"</span><span class="token punctuation">,</span><br>  <span class="token property">"starring"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Actor One"</span><span class="token punctuation">,</span> <span class="token string">"Actor Two"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>This now allows us to send new movies to our server. While this is a good start, what if something goes wrong? It would be good to have some way to check what we send and return an error. To do this we can make use of <code>inline fragments</code>.</p>
<h3 id="inline-fragments" tabindex="-1">Inline Fragments</h3>
<p><a href="https://graphql.org/learn/queries/#inline-fragments">Inline Fragments</a> are used when we want to query a field that returns more than one type of result.</p>
<p>We'd like to have a query that can return a <code>NewMovie</code> type if all goes well, but also will return an <code>Error</code> object if something goes wrong.</p>
<p>To prepare this we need to make a few changes to our <code>typeDefs</code>. First we add a new <code>Error</code> type:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span><br>  <span class="token attr-name">message</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br><span class="token punctuation">}</span></code></pre>
<p>Then we can make a new <code>union</code> type that combines both <code>NewMovie</code> and <code>Error</code>:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">union</span> <span class="token class-name">NewMovieOrError</span> <span class="token operator">=</span> <span class="token property">NewMovie</span> <span class="token operator">|</span> <span class="token property">Error</span></code></pre>
<p>A <a href="https://graphql.org/learn/schema/#union-types">union</a> is a special type that combines two or more types. It's a way of saying this type can be either a <code>NewMovie</code> or an <code>Error</code>.</p>
<p>To finish the schema changes, update our existing <code>createMovie</code> mutation to return an object of type <code>NewMovieOrError</code>:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Mutation</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">createMovie</span><span class="token punctuation">(</span><br>    <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span><br>    <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br>  <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">NewMovieOrError</span><br><span class="token punctuation">}</span></code></pre>
<p>Next we update our <code>resolvers</code>. Let's begin by updating our <code>createMovie</code> resolver to return an error if the <code>title</code> is empty:</p>
<pre class="language-js"><code class="language-js"><span class="token function-variable function">createMovie</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> starring <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// We could validate and update a database here</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      id<span class="token operator">:</span> <span class="token string">'err-01'</span><span class="token punctuation">,</span><br>      message<span class="token operator">:</span> <span class="token string">'Title should not be blank'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    id<span class="token operator">:</span> <span class="token string">'new-id'</span><span class="token punctuation">,</span><br>    title<span class="token punctuation">,</span><br>    starring<br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>When GraphQL returns <code>NewMovieOrError</code> from the request, we need to tell it what type of object it actually is. To do this we need to resolve the type manually.</p>
<p>This means adding one more resolver, specifically for the <code>NewMovieOrError</code> type. Add this to the <code>resolvers</code> object:</p>
<pre class="language-js"><code class="language-js">NewMovieOrError<span class="token operator">:</span> <span class="token punctuation">{</span><br>  <span class="token function">__resolveType</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> context<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br>    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token string">'Error'</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token string">'NewMovie'</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span></code></pre>
<p>Now we can try a GraphQL query. If you had any trouble with the above steps, you can <a href="https://github.com/donovanh/graphql-apollo-example/blob/main/index.js">refer to the complete index.js file here</a>.</p>
<p>Our query can look something like this:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">mutation</span> <span class="token definition-mutation function">NewMovie</span><span class="token punctuation">(</span><br>  <span class="token variable variable-input">$title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span><br>  <span class="token variable variable-input">$starring</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query property-mutation">createMovie</span><span class="token punctuation">(</span><br>    <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token variable variable-input">$title</span><span class="token punctuation">,</span><br>    <span class="token attr-name">starring</span><span class="token punctuation">:</span> <span class="token variable variable-input">$starring</span><br>  <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span><br>      <span class="token property">id</span><span class="token punctuation">,</span><br>      <span class="token property">message</span><br>    <span class="token punctuation">}</span><br>    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">NewMovie</span> <span class="token punctuation">{</span><br>      <span class="token property">id</span><span class="token punctuation">,</span><br>      <span class="token property">title</span><span class="token punctuation">,</span><br>      <span class="token property">starring</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>You'll notice two additions, <code>... on Error</code> and <code>... on NewMovie</code>. These allow us to shape a request that depends on the type of object given to us, whether it's a <code>NewMovie</code> or an <code>Error</code>.</p>
<p>Try it out by setting the variables with an empty title:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span><br>  <span class="token property">"starring"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Actor One"</span><span class="token punctuation">,</span> <span class="token string">"Actor Two"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>This should give us a response like:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"createMovie"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"err-01"</span><span class="token punctuation">,</span><br>      <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Title should not be blank"</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This is a powerful way to add conditional logic that makes our queries more robust.</p>
<h3 id="meta-fields" tabindex="-1">Meta fields</h3>
<p>When working with a new GraphQL API it can be worthwhile taking a look around to see what sort of queries we can carry out. To help with this, GraphQL gives us a set of special queries. We will take a look at some here.</p>
<h4 id="__schema" tabindex="-1">__schema</h4>
<p>Querying the <code>__schema</code> field on the root type gives us access to lots of different aspects of the schema. From the full list of <code>types</code>, the available <code>directives</code>, <code>queryType</code> fields and <code>mutationType</code> fields.</p>
<p>For example if we wanted to see what sorts of queries (<code>query</code> or <code>mutation</code>) we can run on our movies database, we can check by running:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span><br>  <span class="token object">__schema</span> <span class="token punctuation">{</span><br>    <span class="token object">queryType</span> <span class="token punctuation">{</span><br>      <span class="token object">fields</span> <span class="token punctuation">{</span><br>        <span class="token property">name</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token object">mutationType</span> <span class="token punctuation">{</span><br>      <span class="token object">fields</span> <span class="token punctuation">{</span><br>        <span class="token property">name</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h4 id="__typename" tabindex="-1">__typename</h4>
<p>If we were building a query using <code>inline fragments</code> and wanted to know the type name of a movie and actor field, we can use the <code>__typename</code> field to obtain it.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span><br>  <span class="token property-query">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span><span class="token string">"m01"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">title</span><span class="token punctuation">,</span><br>    <span class="token object">starring</span> <span class="token punctuation">{</span><br>      <span class="token property">__typename</span><br>      <span class="token property">name</span><br>      <span class="token object">appearsIn</span> <span class="token punctuation">{</span><br>        <span class="token property">title</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This is just some of what you can do. Find out more in the <a href="https://graphql.org/learn/introspection/">Introspection documentation</a>.</p>
<h3 id="adding-new-queries" tabindex="-1">Adding new queries</h3>
<p>Before we finish up this section let's add one more query, which might be useful when we want to build a web interface to our API. We'll add an extra query to let us look up a list of movies by actor name, called <code>moviesStarring</code>.</p>
<p>Begin by adding the type definition to our <code>typeDefs</code>:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">MoviesStarring</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>  <span class="token attr-name">movies</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Movie</span><span class="token punctuation">]</span><span class="token operator">!</span> <br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">actors</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Actor</span><span class="token punctuation">]</span><br>  <span class="token attr-name">movies</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Movie</span><span class="token punctuation">]</span><br>  <span class="token attr-name">actor</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Actor</span><br>  <span class="token attr-name">movie</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Movie</span><br>  <span class="token attr-name">moviesStarring</span><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">MoviesStarring</span><br><span class="token punctuation">}</span></code></pre>
<p>Here we add a new type called <code>MoviesStarring</code>, which expects a name and an array of movies. Then we add one new query to the <code>Query</code> block, called <code>moviesStarring</code>.</p>
<p>Then add a <code>resolver</code> to our <code>resolvers</code> object:</p>
<pre class="language-js"><code class="language-js"><span class="token function-variable function">moviesStarring</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> actor <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>actors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">actor</span><span class="token punctuation">)</span> <span class="token operator">=></span> actor<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    name<span class="token punctuation">,</span><br>    movies<span class="token operator">:</span> actor<span class="token punctuation">.</span>appearsIn<br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>This will let us look up movies by searching for the actor's name. It compares the given value (converted to lowercase) against each actor name. Then if it finds a match, it will return an array of <code>movie</code> objects.</p>
<p>We can query it as so:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token punctuation">{</span><br>  <span class="token property-query">moviesStarring</span><span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">:</span><span class="token string">"Steve Buscemi"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">name</span><br>    <span class="token object">movies</span> <span class="token punctuation">{</span><br>      <span class="token property">title</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Which should give us a JSON response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"moviesStarring"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Steve Buscemi"</span><span class="token punctuation">,</span><br>      <span class="token property">"movies"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">{</span><br>          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><br>        <span class="token punctuation">}</span><span class="token punctuation">,</span><br>        <span class="token punctuation">{</span><br>          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Pulp Fiction"</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In this way, it's quite simple to add new ways to access our API and put together useful ways for our API users to make use of it. It's good to think about how people might want to access data while designing a GraphQL schema.</p>
<p>Lets make use of this new query while integrating GraphQL into a web page.</p>
<h2 id="graphql-from-the-browser" tabindex="-1">GraphQL from the browser</h2>
<p>To show how we can use GraphQL in the browser, we will set up a simple demo. This demo will be a web page that lets our users select an actor, and then show a list of movies this actor has been in.</p>
<p>This will make use of two GraphQL queries, <code>actors</code> and <code>moviesStarring</code>.</p>
<p>Before we set up our front-end, we need a server.</p>
<h3 id="remote-apollo-server" tabindex="-1">Remote Apollo server</h3>
<p>If you are familiar with setting up a Node.js server, you can deploy our example wherever you like. It can be deployed to Heroku, AWS or your own server.</p>
<p>However to save some time, I have set up the <a href="https://graphql-apollo-example.vercel.app/">example Movies API on Vercel</a>.</p>
<p>We will be able to use this remote server with a <code>GET</code> request to use GraphQL queries from the browser. For example, a <a href="https://graphql-apollo-example.vercel.app/?query=%7B%20movies%20%7B%20title%20%7D%20%7D&amp;variables=%7B%7D">request lke this</a> will return the <code>JSON</code> response:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"movies"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"True Romance"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token punctuation">{</span><br>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Pulp Fiction"</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This will allow us to send requests from a website. Let's set that up next.</p>
<h3 id="website%3A-html-%26-css" tabindex="-1">Website: HTML &amp; CSS</h3>
<p>As this is a getting started guide, we will try to keep our example as simple as possible so that we can focus on making use of our GraphQL queries.</p>
<p>If at any point you find yourself stuck, check the source for this <a href="https://hop.ie/graphql-apollo-example/">finished example</a>.</p>
<p>Let's get started. Make a HTML file (<code>index.html</code>) and paste in the following HTML code.</p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Starring in... Movies API Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preconnect<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.gstatic.com<span class="token punctuation">"</span></span> <span class="token attr-name">crossorigin</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css2?family=Limelight&amp;family=Open+Sans&amp;display=swap<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://hop.ie/graphql-apollo-example/styles.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Starring in...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>actor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>loading<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span> starred in...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>movies<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br>    <span class="token comment">// Our GraphQL logic will go here</span><br>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p>Whild developing our local web site we need to serve it and access it on <code>localhost</code>. There are many ways to do this but one simple way is to use Python's built-in server.</p>
<p>If you are on a Mac, you can run the local server by navigating in your terminal to the folder containing <code>index.html</code> and running:</p>
<pre class="language-bash"><code class="language-bash">python -m SimpleHTTPServer <span class="token number">8020</span></code></pre>
<p>If you're using Python 3, you might want to try this version:</p>
<pre class="language-bash"><code class="language-bash">python -m http.server <span class="token number">8020</span></code></pre>
<p>Now you should be able to open <code>http://localhost:8020/</code> and see the starting HTML. Let's look at how we can fetch some data from the GraphQL API.</p>
<h3 id="making-a-get-request" tabindex="-1">Making a GET request</h3>
<p>Now that we have some HTML, and it's running in our browser, we can add some JavaScript to get a feel for how we might use our GraphQL API.</p>
<p>Let's start with a simple query to get a list of movies. Add the following between the <code>script</code> tags:</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// Get the movies from the API</span><br><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{<br>  movies { title }<br>}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> queryString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?query=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;variables=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://graphql-apollo-example.vercel.app/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>queryString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token function">sendRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In this example we set up some variables, <code>query</code> (and an empty <code>variables</code> container), then we use these to build a <code>queryString</code>. This makes a <code>GET</code> request to out server, when we lastly prepend the server address to finish building the <code>url</code>.</p>
<p>We use <code>encodeURIComponent</code> to convert the GraphQL query, and the <code>variables</code> JSON, into a URL-friendly format.</p>
<p>Lastly we set up an <code>async</code> <code>sendRequest</code> function. This is where we use the browser's <code>fetch</code> method to hit the given URL, process the returned <code>JSON</code>, and log it to the console.</p>
<p>With our URL built, refresh the page and check the <code>console</code> output. It should give us a response like:</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  data<span class="token operator">:</span> <span class="token punctuation">{</span><br>    movies<span class="token operator">:</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Reservoir Dogs"</span> <span class="token punctuation">}</span><br>      <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"True Romance"</span> <span class="token punctuation">}</span><br>      <span class="token punctuation">{</span> title<span class="token operator">:</span> <span class="token string">"Pulp Fiction"</span> <span class="token punctuation">}</span><br>    <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>This is similar to what we saw in the previous examples, but we now have this response available in the browser.</p>
<p>Note: Since this is a demo, we're not worrying about browser compatibility. If you do want to use <code>fetch</code> you might want to also consider a polyfill such as <a href="https://www.npmjs.com/package/whatwg-fetch">whatwg-fetch</a>.</p>
<p>Let's build on this idea to make something more useful.</p>
<h3 id="requesting-actors-and-movies" tabindex="-1">Requesting actors and movies</h3>
<p>We'll take this simple idea above and set up some handy functions so that we can create a useful little website.</p>
<p>We begin by removing the content of our <code>script</code> tags. Then we'll add a re-usable function to make requests:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> variables <span class="token operator">=</span> <span class="token string">'{}'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> queryString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?query=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;variables=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://graphql-apollo-example.vercel.app/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>queryString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>We can now add two more functions to load a list of <code>actors</code> and then populate the <code>select</code>:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">setupActors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{<br>    actors {<br>      name<br>    }<br>  }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> parsedResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> dropdown <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select[name=actor]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">addActorsToDropdown</span><span class="token punctuation">(</span>dropdown<span class="token punctuation">,</span> parsedResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>actors<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  dropdown<span class="token punctuation">.</span>onchange <span class="token operator">=</span> onActorChange<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">addActorsToDropdown</span><span class="token punctuation">(</span><span class="token parameter">dropdown<span class="token punctuation">,</span> actors</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  dropdown<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Remove the loading option</span><br>  <span class="token keyword">const</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  option<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  option<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'Select an actor'</span><span class="token punctuation">;</span><br>  dropdown<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> actor <span class="token keyword">of</span> actors<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"option"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    option<span class="token punctuation">.</span>value <span class="token operator">=</span> actor<span class="token punctuation">.</span>name<span class="token punctuation">;</span><br>    option<span class="token punctuation">.</span>text <span class="token operator">=</span> actor<span class="token punctuation">.</span>name<span class="token punctuation">;</span><br>    dropdown<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">onActorChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// TODO</span><br><span class="token punctuation">}</span></code></pre>
<p>These functions make use of our <code>makeRequest</code> function, and set up the <code>select</code> with the returned list of actors.</p>
<p>We then add a listener for the <code>onchange</code> event of this <code>select</code>. When the actor name is selected, it will call <code>onActorChange</code>.</p>
<p>If we refresh the page now, we should see the <code>Loading...</code> text replaced by a list of actors.</p>
<h4 id="showing-the-movies" tabindex="-1">Showing the movies</h4>
<p>Let's now add some interactivity. Replace the <code>onActorChange</code> function above with the following functions:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">onActorChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> name <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> moviesUL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#movies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> nameSpan <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Empty the movies list first</span><br>  moviesUL<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token comment">// Set the searching-for name</span><br>  nameSpan<span class="token punctuation">.</span>innerText <span class="token operator">=</span> name<br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">showMovieInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Send it to the server</span><br>  <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">query MoviesStarring($name: String!) {<br>    moviesStarring(name: $name) {<br>      name<br>      movies {<br>        title<br>      }<br>    }<br>  }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{<br>    "name": "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"<br>  }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> parsedResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> queryResult <span class="token operator">=</span> parsedResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>moviesStarring<span class="token punctuation">;</span><br>  <span class="token function">showMovieInfo</span><span class="token punctuation">(</span>queryResult<span class="token punctuation">.</span>name<span class="token punctuation">,</span> queryResult<span class="token punctuation">.</span>movies<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">showMovieInfo</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> movies</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> info <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#info'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> moviesUL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#movies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    info<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> movie <span class="token keyword">of</span> movies<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> movieLI <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    movieLI<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>movie<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    moviesUL<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>movieLI<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  info<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'block'</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Let's start from the function called by the <code>onchange</code> event. Our <code>onActorChange</code> function will firstly clear out any existing movies, and set the <code>name</code> of the actor we selected.</p>
<p>We then make a request to the server looking for <code>MoviesStarring</code>. We set <code>variables</code> JSON to include the actor name, then send the result of this query to the <code>showMovieInfo</code> function.</p>
<p>The <code>showMovieInfo</code> function gets the name and a list of movies, and uses these to built then show the <code>ul</code> list.</p>
<p>Now if you refresh the page, you should be able to select a name and see some of the movies they starred in.</p>
<p><img src="/assets/img/posts/graphql/graphql-apollo-example.png" alt="A GraphQL-based movie search example webpage"></p>
<h4 id="showing-query-information" tabindex="-1">Showing query information</h4>
<p>If you want to see a little extra info, I've added some more logic to the <a href="https://hop.ie/graphql-apollo-example/">online GraphQL Apollo example</a>, showing the query info to the bottom of the screen. This might be helpful to see the queries as they occur.</p>
<h3 id="adding-mutations" tabindex="-1">Adding mutations</h3>
<p>We have shown how to send <code>query</code> requests to our GraphQL API, but how can we send <code>mutation</code> requests? The answer is to send a <code>POST</code>.</p>
<p>Before we wrap up this getting started guide, let's try sending a <code>mutation</code> to our Apollo server to show it in action.</p>
<p>Replace the JavaScript in our <code>script</code> tags with this snippet:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mutation NewMovie(<br>  $title: String!,<br>  $starring:[String!]!<br>) {<br>  createMovie(<br>    title: $title,<br>    starring: $starring<br>  ) {<br>    ... on Error {<br>      id,<br>      message<br>    }<br>    ... on NewMovie {<br>      id,<br>      title,<br>      starring<br>    }<br>  }<br>}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token punctuation">{</span><br>  title<span class="token operator">:</span> <span class="token string">"Test movie"</span><span class="token punctuation">,</span><br>  starring<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Actor One"</span><span class="token punctuation">,</span> <span class="token string">"Actor Two"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mutationRequest</span><span class="token punctuation">(</span><span class="token parameter">query<span class="token punctuation">,</span> variables</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://graphql-apollo-example.vercel.app'</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span><br>    headers<span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token string">'Accept'</span><span class="token operator">:</span> <span class="token string">'application/json, text/plain, */*'</span><span class="token punctuation">,</span><br>      <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>query<span class="token punctuation">,</span> variables<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> responseJSON <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>responseJSON<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">mutationRequest</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> variables<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If we check out <code>console</code> we should see a data response that confirms the movie details we sent, along with an <code>id</code>. We can test the above with an empty movie title to see the error response too!</p>
<p>This simply demonstrates how the <code>POST</code> option can enable sending mutations, but we don't have a form for the page to send info the server. I'll leave that as an exercise for the reaser, should you wish to give it a go.</p>
<h2 id="wrapping-up" tabindex="-1">Wrapping up</h2>
<p>By now we should have a good understanding of what GraphQL is, when we might want to use it, and be confident using GraphQL queries for generating requests to our APIs.</p>
<p>We've learned how to build our own GraphQL server, including how to define a schema. Within the schema we have used <code>types</code> to define the shape of the data we expect to use along with <code>query</code> and <code>mutation</code> queries.</p>
<p>We then got our server running and explored how to build all sorts of queries, including variables, inline fragments, named operations and more, and made us of our server with requests from a web site.</p>
<p>Congratulations! I hope you have found this a helpful and fun getting started guide to GraphQL.</p>
<h2 id="next-steps" tabindex="-1">Next steps</h2>
<h3 id="graphql-implementations" tabindex="-1">GraphQL implementations</h3>
<p>No matter what language you want to use, you'll likely find a tool to integrate GraphQL. Check out the official <a href="https://graphql.org/code/">GraphQL Code page</a> for lots of options.</p>
<p>For example, some front-end tools you might want to investigate include:</p>
<ul>
<li><a href="https://www.apollographql.com/docs/react/">Apollo Client</a></li>
<li><a href="https://relay.dev/">Relay</a></li>
<li><a href="https://github.com/prisma-labs/graphql-request">graphql-request</a></li>
<li><a href="https://github.com/kadirahq/lokka">Lokka</a></li>
</ul>
<p>If you're looking for a way to generate powerful yet static websites while making the most of GraphQL, be sure to check out <a href="https://www.gatsbyjs.com/">Gatsby</a>.</p>
<h3 id="best-practices-and-testing" tabindex="-1">Best practices and testing</h3>
<p>The official GraphQL website has a <a href="https://graphql.org/learn/best-practices/">guide to best practices</a> that includes pagination, caching, and more. You might want to also check out their <a href="https://graphql.org/learn/thinking-in-graphs/">Thinking in Graphs</a> guide.</p>
<p>When using Apollo Server, you might want to delve into their <a href="https://www.apollographql.com/docs/apollo-server/testing/testing/">Integration testing guide</a> to get started. They also offer a <a href="https://www.apollographql.com/docs/apollo-server/testing/mocking/">Mocking</a> option that helps when constructing tests or <a href="https://storybook.js.org/addons/storybook-addon-apollo-client">using Apollo with Storybook</a>.</p>
<h3 id="third-party-services" tabindex="-1">Third party services</h3>
<p>There is a lot of movement in software-as-a-service world around GraphQL, but a couple of options to begin with would be <a href="https://aws.amazon.com/appsync/">AWS AppSync</a>, Amazon's tool for deploying GraphQL APIs, and <a href="https://graphcms.com/">GraphCMS</a>, a content management service built around GraphQL.</p>
<h3 id="further-learning" tabindex="-1">Further learning</h3>
<p>Learn some of the theory behind GraphQL by studying up on <a href="https://javascript.plainenglish.io/graph-data-structure-implementation-in-javascript-668f291a8a16">Graph Data Structure in JavaScript</a>.</p>
<p>When you're investigating GraphQL APIs, be sure to keep this <a href="https://graphql.org/learn/introspection/">official Introspection guide</a> handy as a reference.</p>

    </div>

    <div>
    TODO: Get your certificate of completion!
    </div>

    <p>Did this get you started on GraphQL? Ideas or feedback, <a href="mailto:donovan@getstarted.dev">get in touch</a>!</p>

</article>

<div class="back-to-top" id="back-to-top">
    <p><a href="#top">Back to top</a></p>
</div>
    </main>

    <footer>
    <div class="mailing-list">
        <h2>Get on the mailing list</h2>
        <form action="https://www.getrevue.co/profile/getstarted/add_subscriber" method="post" id="revue-form" name="revue-form"  target="_blank">
            <div class="form-group">
                <label for="member_email">Email address</label>
                <input placeholder="Your email address..." type="email" name="member[email]" id="member_email">
            </div>
            <div class="form-actions">
                <input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit">
            </div>
        </form>
        <p>You'll get occasional updates when new content is posted. <a target="_blank" href="https://www.getrevue.co/privacy">Privacy policy</a>.</p>
    </div>
        
    <p>&copy; 2020 <a target="_blank" href="https://hop.ie">Donovan Hutchinson</a></p>
</footer>


    
<script src="/assets/js/back-to-top.js"></script>
</body>
</html>